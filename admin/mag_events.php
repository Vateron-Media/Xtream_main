<?php
include "session.php";
include "functions.php";
if ((!$rPermissions["is_admin"]) or (!UIController::hasPermissions("adv", "manage_events"))) {
    exit;
}

include "header.php";
?>
                <div class="wrapper">
                    <div class="container-fluid">

                    <!-- start page title -->
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box">
                                <h4 class="page-title"><?= $_["mag_events"] ?></h4>
                            </div>
                        </div>
                    </div>
                    <!-- end page title -->

                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body" style="overflow-x:auto;">
                                    <table id="datatable" class="table table-hover dt-responsive nowrap">
                                        <thead>
                                            <tr>
                                                <th class="text-center"><?= $_["date"] ?></th>
                                                <th class="text-center"><?= $_["status"] ?></th>
                                                <th class="text-center"><?= $_["mac_address"] ?></th>
                                                <th><?= $_["event"] ?></th>
                                                <th><?= $_["message"] ?></th>
                                                <th class="text-center"><?= $_["actions"] ?></th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>

                                </div> <!-- end card body-->
                            </div> <!-- end card -->
                        </div><!-- end col-->
                    </div>
                    <!-- end row-->
                </div> <!-- end container -->
            </div>
            <!-- end wrapper -->
            <!-- Footer Start -->
            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 copyright text-center"><?= UIController::getFooter() ?></div>
                    </div>
                </div>
            </footer>
            <!-- end Footer -->

            <script src="assets/js/vendor.min.js"></script>
            <script src="assets/libs/jquery-toast/jquery.toast.min.js"></script>
            <script src="assets/libs/datatables/jquery.dataTables.min.js"></script>
            <script src="assets/libs/datatables/dataTables.bootstrap4.js"></script>
            <script src="assets/libs/datatables/dataTables.responsive.min.js"></script>
            <script src="assets/libs/datatables/responsive.bootstrap4.min.js"></script>
            <script src="assets/libs/datatables/dataTables.buttons.min.js"></script>
            <script src="assets/libs/datatables/buttons.bootstrap4.min.js"></script>
            <script src="assets/libs/datatables/buttons.html5.min.js"></script>
            <script src="assets/libs/datatables/buttons.flash.min.js"></script>
            <script src="assets/libs/datatables/buttons.print.min.js"></script>
            <script src="assets/libs/datatables/dataTables.keyTable.min.js"></script>
            <script src="assets/libs/datatables/dataTables.select.min.js"></script>

            <!-- Datatables init -->
            <script>
                function api(rID, rType) {
                    if (rType == "delete") {
                        if (confirm('<?= $_["device_delete_confirm"] ?>') == false) {
                            return;
                        }
                    }
                    $.getJSON("./api.php?action=mag_event&sub=" + rType + "&mag_id=" + rID, function (data) {
                        if (data.result === true) {
                            if (rType == "delete") {
                                $.toast("<?= $_["event_confirmed"] ?>");
                            }
                            $.each($('.tooltip'), function (index, element) {
                                $(this).remove();
                            });
                            $('[data-toggle="tooltip"]').tooltip("hide");
                            $("#datatable").DataTable().ajax.reload(null, false);
                        } else {
                            $.toast("<?= $_["error_occured"] ?>");
                        }
                    });
                }

                $(document).ready(function () {
                    $("#datatable").DataTable({
                        language: {
                            paginate: {
                                previous: "<i class='mdi mdi-chevron-left'>",
                                next: "<i class='mdi mdi-chevron-right'>"
                            }
                        },
                        drawCallback: function () {
                            $(".dataTables_paginate > .pagination").addClass("pagination-rounded");
                            $('[data-toggle="tooltip"]').tooltip();
                        },
                        createdRow: function (row, data, index) {
                            $(row).addClass('mag-' + data[0]);
                        },
                        responsive: false,
                        processing: true,
                        serverSide: true,
                        ajax: {
                            url: "./table.php",
                            "data": function (d) {
                                d.id = "mag_events";
                            }
                        },
                        columnDefs: [{
                            "className": "dt-center",
                            "targets": [0, 1, 2, 5]
                        }]
                    });
                    $("#datatable").css("width", "100%");
                });
            </script>

            <!-- App js-->
            <script src="assets/js/app.min.js"></script>
            </body>

            </html>